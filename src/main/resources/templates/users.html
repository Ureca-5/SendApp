<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="layout :: layout(~{::#content})">
<body>

<section id="content">
  <div class="panel__head">
    <h2 class="panel__title">Users</h2>
    <div class="panel__meta">
      <span class="chip">Total: <strong th:text="${total}">0</strong></span>
    </div>
  </div>

  <div class="panel__body">

    <!-- Filters -->
    <form class="filterbar" method="get" th:action="@{/users}">
      <input type="hidden" name="billing_yyyymm" th:value="${billing_yyyymm}" />
      <input type="hidden" name="page" value="0" />

      <div class="filterbar__row">
        <div class="field">
          <label class="label" for="keyword">keyword</label>
          <input id="keyword" name="keyword" class="input" placeholder="users_id or name"
                 th:value="${keyword}" />
        </div>

        <div class="field">
          <label class="label" for="withdrawn">withdrawn</label>
          <select id="withdrawn" name="withdrawn" class="select">
            <select id="withdrawn" name="withdrawn" class="select">
  <option value="" th:selected="${withdrawn == null}">ALL</option>
  <option value="false" th:selected="${withdrawn != null and !withdrawn}">ACTIVE</option>
  <option value="true" th:selected="${withdrawn != null and withdrawn}">WITHDRAWN</option>
</select>

            <option th:selected="${withdrawn != null and withdrawn == false}" th:value="false">ACTIVE</option>
            <option th:selected="${withdrawn != null and withdrawn == true}" th:value="true">WITHDRAWN</option>
          </select>
        </div>

        <div class="field">
          <label class="label" for="size">size</label>
          <select id="size" name="size" class="select">
            <option th:selected="${size==20}" th:value="20">20</option>
            <option th:selected="${size==50}" th:value="50">50</option>
            <option th:selected="${size==100}" th:value="100">100</option>
            <option th:selected="${size==200}" th:value="200">200</option>
          </select>
        </div>

        <div class="field field--actions">
          <label class="label">&nbsp;</label>
          <button class="btn" type="submit">Search</button>
        </div>
      </div>
    </form>

    <!-- Table -->
    <div class="table-wrap">
      <table class="table">
        <thead>
        <tr>
          <th>users_id</th>
          <th>name</th>
          <th>email(masked)</th>
          <th>phone(masked)</th>
          <th>joined_at</th>
          <th>withdrawn</th>
        </tr>
        </thead>

        <tbody>
        <tr th:if="${#lists.isEmpty(users)}">
          <td colspan="6" class="td-muted">No data</td>
        </tr>

        <tr th:each="u : ${users}">
          <td th:text="${u.usersId()}">-</td>
          <td th:text="${u.name()}">-</td>
          <td th:text="${u.emailMasked()}">-</td>
          <td th:text="${u.phoneMasked()}">-</td>
          <td th:text="${u.joinedAt()}">-</td>
          <td>
            <span class="badge" th:classappend="${u.withdrawn()} ? ' badge--danger' : ' badge--ok'"
                  th:text="${u.withdrawn()} ? 'Y' : 'N'">N</span>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pager">
      <div class="pager__left">
        <span class="muted">page</span>
        <strong th:text="${page + 1}">1</strong>
        <span class="muted">/</span>
        <strong th:text="${totalPages == 0 ? 1 : totalPages}">1</strong>
      </div>

      <div class="pager__right">
        <a class="btn btn--ghost"
           th:classappend="${page <= 0} ? ' is-disabled' : ''"
           th:href="@{/users(page=${page-1}, size=${size}, keyword=${keyword}, withdrawn=${withdrawn}, billing_yyyymm=${billing_yyyymm})}">
          Prev
        </a>

        <a class="btn btn--ghost"
           th:classappend="${page >= totalPages-1} ? ' is-disabled' : ''"
           th:href="@{/users(page=${page+1}, size=${size}, keyword=${keyword}, withdrawn=${withdrawn}, billing_yyyymm=${billing_yyyymm})}">
          Next
        </a>
      </div>
    </div>

  </div>
</section>

</body>
</html>
